{% extends 'dashboard_layout_new.html' %}
{{ super() }}
{% block body %}
<head>
  <style>
    .text-field {
    -moz-box-sizing: border-box;
    border: 1px solid #EEEEEE;
    font-family: "Source Sans Pro",Arial,sans-serif;
    font-size: 0.73684em;
    font-weight: 600;
    height: 37px;
    margin: 0;
    padding: 5px;
    width: 100%;
}
.autocomplete-suggestion {
    overflow: hidden;
    padding: 2px 5px;
    white-space: nowrap;
    background-color:white;
    <!--max-width:500px;-->
    <!--margin: auto;-->
    <!--border: 3px solid #73AD21;-->
}
@media only screen and (max-width: 450px){
    .autocomplete-suggestion { width: 80%; }
}

.autocomplete-suggestions strong {
    color: #3399FF;
    font-weight: normal;

}
.autocomplete-selected{
  background-color:#F0F0F0;
}


    </style>

</head>
<div id="accordion">
  <div class="card"  >
    <div class="card-body" style="padding: 1px; ">
      <form class="col s12" action="/searchInfluencers" method="POST" name="form_search" id="form_search">
        <div class="form-body">
          <div class="row" style="padding-top: 2%;">
            <div class="col-xl-3 col-lg-3 col-md-3 mb-1" style="margin-top:3%;">
              <div class="form-group" >
                <select class="form-control" name="channel" style="height:35px;">
                  {% if form_filters['channel'] %}
                  <option value="{{ form_filters['channel'] }}">{{ form_filters['channel'] }}</option>
                  {% endif %}
                  <option value="Youtube">Youtube</option>
                  <option value="Twitter">Twitter</option>
                  <option value="Facebook">Facebook</option>
                  <option value="Instagram">Instagram</option>
                </select>
              </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3 mb-1" style="margin-top:3%;">
              <div class="form-group" >
                <input class="form-control" id="string_word" name="string_word" type="text" placeholder="Enter Keywords"style="height:35px;"
                       {% if form_filters['string_word'] %}
                value="{{ form_filters['string_word'] }}"
                {% endif %}
                >
              </div>
              <!--{{ form_filters }}-->
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3 mb-1" >
              <div class="form-group" >
                <label>Country</label>
                <div class="form-group">
                  <select class="form-control" name="country" style="height:35px;">
                    {% if form_filters['country'] %}
                    <option value="{{ form_filters['country'] }}">{{ form_filters['country_name'] }}</option>
                    <option value=""></option>
                    {% else %}
                    <option value=""></option>
                    {% endif %}

                    {% for item in regionCodes['data'] %}
                    <option value="{{ item['region_code'] }}">{{ item['country_name'] }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3 mb-1">
              <div class="form-group" >
                <p>
                  <label>Followers range:</label>
                </p>
                <div id="slider"  style="height:10px; width: 190px; border-radius: 55px;" ></div>
              </div>
              <div class="row" style="margin-left:3%;">
                <div class="col-2.5" id="lower-value" style="column-width:50px; border:1px solid black; padding-left:2px; padding-right:1px; margin-left:2%;"></div>
                <div class="col-2.5" id="upper-value" style="column-width:50px; border:1px solid black; padding-right:2px; padding-left:2px; margin-left:12%;"></div>
              </div>
              <input type="hidden" name="min_lower" value="" id="min_lower">
              <input type="hidden" name="max_upper" value="" id="max_upper">
              <!--{{ form_filters }}-->
            </div>
          </div>
          <div class="row">
            <div class="col-xl-4 col-lg-4 col-md-4 mb-1">
            </div>
            <div class="col-xl-4 col-lg-4 col-md-4 mb-1">
              <div class="form-group spacing" style="margin-left:20%;">
                <button id="btn-search-inf" type="submit" class="btn btn-raised btn-raised btn-primary customButton" name="search_inf" style="padding-right: 10px; padding-left: 10px; padding-top: 2.5px; padding-bottom: 2.5px;">
                  Search <i class="fa fa-search"></i>
                </button>
              </div>
            </div>
            <div class="col-xl-4 col-lg-4 col-md-4 mb-1">
            </div>
          </div>
        </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-body">
        <div class="card-block">
          <div class="row" style="margin-left: 2%;">
            <div class="col-xl-4 col-lg-4 col-md-4 mb-1">
              {% if data['data'] %}
              <button type="button"  style="background-color: purple; margin-left: 2%; color:white; border-radius: 10px; font-size:15px;">Export CSV</button>
              {% else %}
              <!--<button type="button"  style="background-color: purple; margin-left: 2%; color:white; border-radius: 10px; font-size:15px;">Export CSV</button>-->
              {% endif %}
            </div>
            <div class="col-xl-4 col-lg-4 col-md-4 mb-1"><h4  class="text-center">Influencers on Youtube</h4>
            </div>
            <div class="col-xl-4 col-lg-4 col-md-4 mb-1" >
              <div class="form-group">
                <div class="form-group" style="margin-left:12%;">
                  <select class="form-control" name="sort_order" placeholder="Sort" style="width:140px;">
                    {% if form_filters['sort_order'] %}
                    {% set var_order = form_filters['sort_order'] %}
                    <option value="{{ form_filters['sort_order'] }}">{{ form_filters['sort_order'] }}</option>

                    {% if 'High To Low' == var_order %}
                    <option value="Low To High">Low To High</option>
                    {% elif 'Low To High' == var_order %}
                    <option value="High To Low">High To Low</option>
                    {% endif %}
                    {% else %}
                    <option value="High To Low">High To Low</option>
                    <option value="Low To High">Low To High</option>
                    {% endif %}
                  </select>
                </div>
              </div>
            </div>
          </div>
          </form>
          <div class="container contents" id="wrapper">
            {% for item in data['data'] %}
            <div class="row ">
              <div>
                <table cellspacing="1" border="solid 1px #E1DEDD;">
                  <tr>
                    <td rowspan="3" style="border-left:solid 1px white;">
                      <a href="/compose" class="fa fa-envelope" data-toggle="tooltip" title="Message" style="position: relative; z-index: 1; font-size:25px;"></a>
                      <br>
                      {% if form_filters['campaign_id'] %}
                      <a href="/addToCampaign/{{  form_filters['campaign_id'] }}" class="fa fa-bullseye red" data-toggle="tooltip" title="Add To Campaign" style="font-size:25px;"><i class="fa fa-plus-circle green" style="font-size:10px; position:relative; top:5px; left:-8px;"></i></a>
                      {% else %}
                      <span data-toggle="modal" data-target="#campaignList">
                      <a onclick="campaignList('{{ item['channel_id'] }}')"  class="fa fa-bullseye red" data-toggle="tooltip" title="Add To Campaign" style="font-size:25px;"><i class="fa fa-plus-circle green" style="font-size:10px; position:relative; top:5px; left:-8px;"></i></a>
                      </span>
                      {% endif %}
                      <br>
                      <a href="/addToFavInfList/{{ item['channel_id'] }}"  class="fa fa-star-o yellow"  data-toggle="tooltip" title="Add To Favorites" style="font-size:25px;"><i class="fa fa-plus-circle green" style="font-size:10px; position:relative; top:1px; left:-10px;"></i></a>
                      <br>
                      <span data-toggle="modal" data-target="#create_alert_modal">
                      <a onclick="createAlert('{{ item['channel_id'] }}','{{ item['subscriberCount_gained'] }}','{{ (item['total_100video_views']/100)|int }}','{{ (item['total_100video_likes']/100)|int }}','{{ (item['total_100video_comments']/100)|int }}')" class="fa fa-bell black"  data-toggle="tooltip" title="Create Alerts" style="font-size:25px;"><i class="fa fa-plus-circle green" style="font-size:10px; position:relative; top:1px; left:-10px;"></i></a>
                      </span>
                    </td>
                    <td rowspan="4">
                      <img src="{{ item['channel_img'] }}" height="150px" width="155px">
                    </td>
                    <td colspan="2" style="border-right: solid 1px #E1DEDD;">
                      <table width="400px" cellpadding="1">
                        <tr>
                          <td colspan="2"><b style="font-size:15px;"><a href="https://www.youtube.com/channel/{{ item['channel_id'] }}" target="_blank">{{ item['title'] }}</a></b> <i class="fa fa-youtube-play font-medium-3 red"></i></td>
                        </tr>
                        <tr>
                          <td style="text-align:center;border-right: solid 1px #E1DEDD; border-bottom:solid 1px #E1DEDD; border-top:solid 1px #E1DEDD; font-size:14px;">
                            <b>{{ item['subscriberCount_gained'] }}</b>
                            <br>
                            Total followers
                          </td>
                          <td style="text-align:center;border-bottom:solid 1px #E1DEDD; border-top:solid 1px #E1DEDD;  font-size:14px;">
                            <b>{{ (item['total_100video_likes']/100)|int }}</b>
                            <br>
                            Avg Likes/ video
                          </td>
                        </tr>
                        <tr>
                          <td style="text-align:center;border-right: solid 1px #E1DEDD; border-bottom:solid 1px #E1DEDD;  font-size:14px;">
                            <b>{{ (item['total_100video_views']/100)|int }}</b>
                            <br>
                            Avg Views/ video
                          </td>
                          <td style="text-align:center;font-size:14px;">
                            <b>{{ (item['total_100video_comments']/100)|int }}</b>
                            <br>
                            Avg Comments/ video
                          </td>
                        </tr>
                        <tr><td colspan="2">
                          <b style="font-size:12px">Other Channels</b> &emsp;
                          {% if item['facebook_url'] %}
                          <a href="{{ item['facebook_url'] }}" target="_blank" class="fa fa-facebook-official blue" style="font-size:20px;"></a>&emsp;
                          {% endif %}
                          {% if item['insta_url'] %}
                          <a href="{{ item['insta_url'] }}" target="_blank" class="fa fa-instagram pink" style="font-size:20px;"></a>&emsp;
                          {% endif %}
                          {% if item['twitter_url'] %}
                          <a href="{{ item['twitter_url'] }}" target="_blank" class="fa fa-twitter cyan" style="font-size:20px;"></a>&emsp;
                          {% endif %}
                        </td></tr>
                      </table>
                    </td>
                    <td rowspan="4" width="400" style="border-right: solid 1px #E1DEDD;" >
                      <div>
                        <canvas id="lineChart{{ item['linechart_id'] }}" height="150px" width="250px"></canvas>
                      </div></td>
                    <td rowspan="4" style="border-right:solid 2px white;">
                      <div class="scroll">
                        <ul class="nav nav-tabs" style="background-color:#DFDEDE  ;">
                          <li style="margin-left:3%; "><a data-toggle="tab" href="#status{{ item['channel_id'] }}" style="color:black;">Status<i class="fa fa-bullseye red"></i></a></li>&nbsp;&ensp;
                          <li><a data-toggle="tab" href="#alert{{ item['channel_id'] }}" style="color:black;">Alert<i class="fa fa-bell black"></i></a></li>
                        </ul>

                        <div class="tab-content">
                          <div id="status{{ item['channel_id'] }}" class="tab-pane fade show active">
                            <b style="font-weight:450;">Campaign 1<br/></b>
                            <b style="font-weight:400; color:orange;">Contacted</b>
                            <hr style="height:0px; margin:auto;">
                            <b style="font-weight:450;">Campaign 2<br/></b>
                            <b style="font-weight: 400; color:green;">Accepted
                            </b>
                            <hr style="height:0px; margin:auto;">
                            <b style="font-weight:450;">Campaign 3<br/></b>
                            <b style="font-weight: 400; color:orange;">Contacted</b>
                          </div>
                          <div id="alert{{ item['channel_id'] }}" class="tab-pane fade">
                            <b style="font-weight:450;">Followers<br/></b>
                            <b style="font-weight:400; color:red;">{{ item['alert_followers'] }}</b>
                            <hr style="height:0px; margin:auto;">
                            <b style="font-weight:450;">Avg Views/video<br/></b>
                            <b style="font-weight: 400; color:red;">{{ item['alert_views'] }}
                            </b>
                            <hr style="height:0px; margin:auto;">
                            <b style="font-weight:450;">Avg Likes/video<br/></b>
                            <b style="font-weight: 400; color:red;">{{ item['alert_likes'] }}
                            </b>
                            <hr style="height:0px; margin:auto;">
                            <b style="font-weight:450;">Avg Comments<br/></b>
                            <b style="font-weight: 400; color:red;">{{ item['alert_comments'] }}</b>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <br>
            {% endfor %}
            <!--<div class="h-100 row align-items-center" id="pagination"></div>-->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<style>
    div.scroll {
        height: 150px;
        width: 150px;
        overflow-y: auto;
    }
    .tabrow {
        list-style: none;
        margin: 0;
        padding: 0;
        line-height: 24px;
    }
    .tabrow li {
        padding: 0 10px;
        border: 1px solid #AAA;
        background: #ECECEC;
        display: inline-block;
    }
</style>
<style>
    /* width */
    ::-webkit-scrollbar {
        width: 10px;
    }
    /* Track */
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: #888;
    }
    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.3/Chart.min.js"></script>

<script>
    {% for item in data['data'] %}
    const CHART{{ item['linechart_id'] }} = document.getElementById("lineChart{{ item['linechart_id'] }}");
    let lineChart{{ item['linechart_id'] }} = new Chart(CHART{{ item['linechart_id'] }}, {
        type: 'line',
        data: {
            labels: ["0", "1", "2", "3", "4", "5", "6"],
            datasets: [
                {
                    label: "Youtube",
                    fill: true,
                    backgroundColor: "rgb(255, 0, 0,0.2)",
                    lineTension: 0.1,
                    borderColor: "red",
                    borderCapStyle: 'butt',
                    borderDash: [],
                    borderDashOffset: 0.0,
                    borderJoinStyle: 'miter',
                    pointBorderColor: "rgba(75,192,192,1)",
                    pointBackgroundColor: "#fff",
                    pointBorderWidth: 1,
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: "rgba(75,192,192,1)",
                    pointHoverBorderColor: "rgba(220,220,220,1)",
                    pointHoverBorderWidth: 2,
                    pointRadius: 1,
                    pointHitRadius: 10,
                    data: [65, 59, 80, 81, 56, 55, 40, 50],
                },         {
                    label: "Twitter",
                    fill: true,
                    backgroundColor: "rgb(0, 255, 255,0.2)",
                    borderColor: "cyan",
                    borderCapStyle: 'butt',
                    borderDash: [],
                    borderDashOffset: 0.0,
                    borderJoinStyle: 'miter',
                    pointBorderColor: "rgba(75,72,192,1)",
                    pointBackgroundColor: "#fff",
                    pointBorderWidth: 1,
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: "rgba(75,72,192,1)",
                    pointHoverBorderColor: "rgba(220,220,220,1)",
                    pointHoverBorderWidth: 2,
                    pointRadius: 1,
                    pointHitRadius: 10,
                    data: [100, 20, 60, 20, 80, 55, 90],
                }
            ]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
    {% endfor %}
</script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.2.24/jquery.autocomplete.min.js"></script>
<script>
   a1 = $('#string_word').autocomplete({
         width: 348,
         delimiter: /(,|;)\s*/,
         lookup: '{{ lookup_string }}'.split(',')
      });

</script>
<script>
$( document ).ready(function() {

        // range slider starts
        var nonLinearSlider = document.getElementById('slider');
        noUiSlider.create(nonLinearSlider, {
	        connect: true,
	        behaviour: 'tap',
	        {% if form_filters['min_lower'] and form_filters['max_upper'] %}
            start: [{{ form_filters['min_lower'] }}, {{ form_filters['max_upper'] }}],
            {% else %}
            start: [0,10000000],
            {% endif %}
	        behaviour: 'tap-drag',
	        tooltips: false,

	        range: {
		    // Starting at 500, step the value by 500,
		    // until 4000 is reached. From there, step by 1000.
		    'min': [ 0 ],
		    <!--'10%': [ 500, 500 ],-->
		    <!--'50%': [ 4000, 1000 ],-->
		    'max': [ 1000000 ]
	        },
	        format: {
                from: function(value) {
                    return parseInt(value);
                },
            to: function(value) {
                return parseInt(value);
                }
            }

        });
        var nodes = [
	        document.getElementById('lower-value'), // 0
	        document.getElementById('upper-value')  // 1
        ];
        // Display the slider value and how far the handle moved
        // from the left edge of the slider.
        nonLinearSlider.noUiSlider.on('update', function ( values, handle, unencoded, isTap, positions ) {
	        nodes[handle].innerHTML = values[handle];
        });
        // range slider ends



});
</script>
<style>
    .noUi-handle-custom{
        border-radius:100px;
        margin-bottom:15%;
    }
    .noUi-target {
    padding: 0 0px;
}
.noUi-handle:before,
.noUi-handle:after {

    width: 17px;
    content: none;
    position: absolute;
    top: 0;
    height: 100%;
    display: block;
}


</style>

<!-- Create alert Modal form-->
<div class="modal fade" id="create_alert_modal" role="dialog" data-backdrop="false">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header alert-primary">
        <b class="modal-title">Create Alert</b>
        <button  type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <form name="create_alert_form" id="create_alert_form" action="/createAlerts" method="POST">
        <div class="modal-body">
                            <span class="display-block overflow-hidden">
                            <!--<label for="channel_id">Channel ID:</label>-->
                        <input  class="form-control" type="hidden" value="" name="channel_id" id="channel_id"></span>
          <span class="display-block overflow-hidden">
                            <label for="total_followers">Total Followers:</label>
        <input class="form-control"  type="number" value="" name="alert_followers" id="total_followers" placeholder="Total Followers"></span><br>
          <span class="display-block overflow-hidden">
                            <label for="total_views">Total Views:</label>
        <input class="form-control"  type="number" value="" name="alert_views" id="total_views" placeholder="Total Views"></span><br>
          <span class="display-block overflow-hidden">
                            <label for="total_likes">Total Likes:</label>
        <input class="form-control"  type="number" value="" name="alert_likes" id="total_likes" placeholder="Total Likes"></span><br>
          <span class="display-block overflow-hidden">
                            <label for="total_comments">Total Comments:</label>
        <input class="form-control"  type="number" value="" name="alert_comments" id="total_comments" placeholder="Total Comments"></span><br>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-default">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Campaign List Modal-->
<div class="modal fade" id="campaignList" role="dialog" data-backdrop="false">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header alert-primary">
        <b class="modal-title">Campaign List</b>
        <button  type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <form name="create_alert_form" id="add_influencer_to_campaign" action="/addInfToCampaignList" method="POST">
        <div class="modal-body">
          <div class="table-responsive" style="background-color: white;">
            <table class="table table-striped">
              <thead>
              <tr>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Select</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Campaign</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Status</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Period</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Channels</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Countries</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Influencers</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">Budget</b></th>
                <th scope="col"><b style="font-weight: 500; font-size:16px;">ROI</b></th>
              </tr>
              </thead>
              <tbody>
              {% for item in view_campaign_data['data'] %}
              <tr>
                <td><input class="form-control" type="checkbox" id="{{ item['campaign_id'] }}"></td>
                <td><a href="/viewCampaignDetails/{{ item['campaign_id'] }}">{{ item['campaign_name'] }}</a></td>
                <td>Cell</td>
                <td>{{ item['from_date'] }}- {{ item['to_date'] }}</td>
                <td>
                  {% set channels = item['channels'].split(',') %}
                  {% for channel in channels %}
                  {% if channel == 'youtube' %}
                  <a href="#" class="fa fa-youtube red"></a>
                  {% elif channel == 'facebook' %}
                  <a href="#" class="fa fa-facebook blue"></a>
                  {% elif channel == 'twitter' %}
                  <a href="#" class="fa fa-twitter"></a>
                  {% elif channel == 'instagram' %}
                  <a href="#" class="fa fa-instagram pink"></a>
                  {% endif %}
                  {% endfor %}
                </td>
                <td>
                  {% for region_name in item['region_name_list'] %}
                  {{ region_name }},
                  {% endfor %}
                </td>
                <td>{{ item['no_of_influencers'] }}
                  <span class="float-right text muted">
                                <!--<a onclick="searchInfluencers('{{ item['campaign_name'] }}','{{ item['campaign_id'] }}','{{ item['channels'] }}','{{ item['video_cat_name'] }}','{{ item['min_lower_followers'] }}','{{ item['max_upper_followers'] }}','{{ item['regions'] }}')" class="fa fa-user-plus black" data-toggle="modal" data-target="#create_alert_modal" data-tooltip="true" title="Add Influencer" style="font-size:20px;"></a>-->
                    <!--<button class="btn btn-sm btn-outline-secondary fa fa-user-plus"></button>-->
                        </span>
                </td>
                <td>{{ item['budget'] }} {{ item['currency'] }}</td>
                <td>Coming Soon</td>
              </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-default">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
function createAlert(channel_id,followers,views,likes,comments) {
    <!--alert(channel_id);-->
    $("#channel_id").val(channel_id);
    $("#total_followers").val(followers);
    $("#total_views").val(views);
    $("#total_likes").val(likes);
    $("#total_comments").val(comments);
}
</script>
<script>
window.onscroll = function() {myFunction()};

var header = document.getElementById("myHeader");
var sticky = header.offsetTop;

function myFunction() {
  if (window.pageYOffset > sticky) {
    header.classList.add("sticky");
  } else {
    header.classList.remove("sticky");
  }
}
</script>
<!--<script>-->
<!--$(document).ready(function(){-->
<!--var clicked;-->
<!--$(".favorite").click(function(){-->
<!--clicked = $(this).attr("name");-->
<!--$.ajax({-->
<!--type : 'POST',-->
<!--url : "{{url_for('test')}}",-->
<!--contentType: 'application/json;charset=UTF-8',-->
<!--data : {'data':clicked}-->
<!--});-->
<!--});-->
<!--});-->
<!--</script>-->
{% endblock %}